naxsi dynamic configuration (aka nginx vars)

Since 0.49, naxsi supports a limited set of variables that can override or modify its behavior.

 * naxsi_flag_learning : If present, this variable will override naxsi learning flag. 
 * naxsi_flag_post_action : If present and set to "0", this variable may be used to disable post_action in learning mode. 
 * naxsi_flag_enable : if present, this variable will override naxsi "SecRulesEnabled"
 * naxsi_extensive_log : If present (and set to “1”), this variable will force naxsi to log the CONTENT of variable matching rules.



It is important to remind that naxsi operates at the REWRITE phase of nginx. Thus, setting those variables directly in the location where naxsi is present is ineffective. 

This is correct:

{{{
set $naxsi_flag_enable 0;
location / {
...
}
}}}


This is correct as well:
{{{
if ($remote_addr = "127.0.0.42") {
 set $naxsi_flag_learning 1;
}
location / {
...
}
}}}

{{{
if ($uri = "/foobar") {
 set $naxsi_extensive_log 1;
}
location / {
...
}
}}}



But this is wrong:
{{{
location / {
         set $naxsi_flag_learning 1;
 ...
}
}}}


==special note on naxsi_extensive_log==

If present (and set to “1”), this variable will force naxsi to log the CONTENT of variable matching rules.

Because of potential performances impacts of naxsi_extensive log, use it with caution. Naxsi will log those to nginx’s error_log, ie:

NAXSI_EXLOG: ip=%V&server=%V&uri=%V&id=%d&zone=%s&var_name=%V&content=%V